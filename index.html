<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com; base-uri 'self'; frame-ancestors 'none';">
    
    <title>Worldview Codex - Map Your Philosophy in 7 Questions</title>
    <meta name="description" content="A privacy-first classroom tool that maps your personal philosophy against 187 historical traditions. No tracking, no database.">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Worldview Codex">
    <meta property="og:description" content="Discover the philosophical architecture of your beliefs.">
    <meta property="og:image" content="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/285/compass_1f9ed.png">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Worldview Codex",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "A client-side philosophical assessment tool that maps user worldviews to historical traditions."
    }
    </script>

    <style>
        /* CSS RESET & VARIABLES */
        :root { 
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60; 
            --bg: #f0f2f5; --card: #ffffff; --text: #333333; --text-light: #666666; 
            --error-bg: #fff1f0; --error-border: #f5222d; --warn-bg: #fffbe6; 
            --warn-border: #faad14; --error-text: #e74c3c; 
        }
        *, *::before, *::after { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg); color: var(--text); 
            line-height: 1.6; margin: 0; padding: 20px; 
            display: flex; justify-content: center; min-height: 100vh; 
        }

        /* LAYOUT */
        .app-wrapper { width: 100%; max-width: 700px; margin-top: 40px; margin-bottom: 60px; display: flex; flex-direction: column; }
        .card { background-color: var(--card); border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); padding: 40px; transition: opacity 0.3s ease; margin-bottom: 20px; }
        
        /* TYPOGRAPHY */
        h1 { text-align: center; color: var(--primary); margin-bottom: 10px; font-size: 2.2rem; }
        h2 { color: var(--primary); margin-top: 0; font-size: 1.5rem; outline: none; } /* Outline none for focus management */
        h3 { color: var(--primary); font-size: 1.3rem; margin-bottom: 5px; }
        .subtitle { text-align: center; color: var(--text-light); margin-bottom: 30px; font-size: 1.1rem; }
        
        /* UTILITIES & ANIMATIONS */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* FORM ELEMENTS */
        fieldset { border: none; padding: 0; margin: 0; }
        .question-explainer { color: var(--text-light); font-size: 0.95rem; margin-bottom: 20px; border-left: 4px solid var(--accent); padding: 10px 15px; background: #f8f9fa; border-radius: 0 4px 4px 0; }
        
        .option-label { display: flex; align-items: flex-start; background-color: #fafafa; border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; margin: 12px 0; cursor: pointer; transition: all 0.2s; }
        .option-label:hover { border-color: var(--accent); background-color: #fbfdff; }
        .option-label:focus-within { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        
        .option-label input[type="radio"] { margin-top: 5px; margin-right: 15px; transform: scale(1.2); accent-color: var(--accent); }
        .option-text { display: flex; flex-direction: column; }
        .option-title { font-weight: 700; color: var(--primary); }
        .option-desc { font-size: 0.9rem; color: var(--text-light); margin-top: 4px; }

        /* BUTTONS */
        button { display: block; width: 100%; padding: 16px; font-size: 1.1em; font-weight: 600; color: #fff; background-color: var(--accent); border: none; border-radius: 8px; cursor: pointer; margin-top: 30px; transition: background-color 0.2s; }
        button:hover { background-color: #2980b9; }
        button:focus { outline: 3px solid rgba(52, 152, 219, 0.4); }
        .submit-btn { background-color: var(--success); }
        .submit-btn:hover { background-color: #219150; }
        .restart-btn { background-color: #7f8c8d; margin-top: 20px; }

        /* ALERTS & RESULTS */
        .validation-error { color: var(--error-text); font-size: 0.9rem; margin-top: 10px; font-weight: 600; display: none; animation: shake 0.3s ease-in-out; }
        .privacy-note-start { background-color: #f8f9fa; border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; font-size: 0.9rem; color: #555; margin-top: 25px; display: flex; align-items: center; gap: 10px; }
        
        .result-box { padding: 25px; border-radius: 8px; margin-top: 25px; border-left: 6px solid transparent; }
        .result-confirmed { background-color: #f6ffed; border-left-color: #52c41a; }
        .result-paradox { background-color: #fffbe6; border-left-color: #faad14; }
        .result-unconfirmed { background-color: var(--warn-bg); border-left-color: var(--warn-border); }
        .result-error { background-color: var(--error-bg); border-left-color: var(--error-border); }
        .result-list { padding-left: 20px; margin-top: 10px; columns: 2; }
        @media (max-width: 600px) { .result-list { columns: 1; } }
        
        .footer { text-align: center; margin-top: auto; padding-top: 20px; color: #999; font-size: 0.85rem; border-top: 1px solid #e0e0e0; }
        .version-badge { background: #2c3e50; color: #fff; font-size: 0.75rem; padding: 3px 8px; border-radius: 12px; vertical-align: middle; margin-left: 10px; }
        .tag { display: inline-block; background: #eee; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; color: #555; margin-left: 8px; vertical-align: middle; }
    </style>
</head>
<body>

<main class="app-wrapper" role="main">
    
    <section id="view-start" class="card fade-in" aria-labelledby="start-title">
        <h1 id="start-title">üß≠ Worldview Codex <span class="version-badge">v65</span></h1>
        <p class="subtitle">Discover the philosophical architecture of your beliefs.</p>
        <p>This tool asks 7 deep questions to map your personal philosophy against 187 distinct historical religions, philosophies, and spiritual movements.</p>
        
        <div class="privacy-note-start">
            <span aria-hidden="true">üîí</span>
            <div><strong>Safe & Private:</strong> This tool runs entirely in your browser. No data is collected, stored, or tracked.</div>
        </div>
        
        <button type="button" id="btn-start">Start the Journey</button>
    </section>

    <section id="view-quiz" class="card hidden" aria-live="polite">
        
        <fieldset id="q1" class="question-block fade-in">
            <legend><h3>1. The Foundation <span class="tag">Layer 1</span></h3></legend>
            <div class="question-explainer">Is the physical universe all that exists, or is there a spiritual dimension?</div>
            
            <label class="option-label">
                <input type="radio" name="meta" value="physical">
                <div class="option-text"><span class="option-title">Purely Physical</span><span class="option-desc">The universe is only matter and energy. There are no spirits, gods, or souls.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="meta" value="more">
                <div class="option-text"><span class="option-title">Something More</span><span class="option-desc">Reality includes a spiritual or conscious dimension beyond just the physical world.</span></div>
            </label>
            
            <div class="validation-error" id="err-q1" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="btn-next" data-current="1">Next Question</button>
        </fieldset>

        <fieldset id="q2" class="question-block hidden fade-in">
            <legend><h3>2. The Author of Your Life <span class="tag">Layer 2</span></h3></legend>
            <div class="question-explainer">Think about your life story. Who is writing the script?</div>
            
            <label class="option-label">
                <input type="radio" name="agency" value="source">
                <div class="option-text"><span class="option-title">I Write the Script (Total Free Will)</span><span class="option-desc">I have 100% authorship. I can rewrite my destiny at any moment, regardless of my past or my biology.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="agency" value="compatibilist">
                <div class="option-text"><span class="option-title">I Improvise the Scene (Shared Agency)</span><span class="option-desc">I have 100% control over my reactions. I didn't choose the setting (genes/environment), but I choose how to play the hand.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="agency" value="determinist">
                <div class="option-text"><span class="option-title">I Play the Role (Determinism)</span><span class="option-desc">I have 100% commitment to the role. The script was written before I was born (by God or Physics).</span></div>
            </label>
            
            <div class="validation-error" id="err-q2" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="btn-next" data-current="2">Next Question</button>
        </fieldset>

        <fieldset id="q3" class="question-block hidden fade-in">
            <legend><h3>3. The Compass <span class="tag">Layer 3</span></h3></legend>
            <div class="question-explainer">When you have a deep question about life, who do you trust most to give you the answer?</div>
            
            <label class="option-label">
                <input type="radio" name="epist" value="evidence">
                <div class="option-text"><span class="option-title">I Look Outward (Sources)</span><span class="option-desc">I trust things outside of myself: Facts, History, Science, Holy Books, or Teachers.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="epist" value="reason">
                <div class="option-text"><span class="option-title">I Look Inward (Insight)</span><span class="option-desc">I trust my own internal tools: My Logic, Intuition, Conscience, or "Gut Feeling."</span></div>
            </label>
            
            <div class="validation-error" id="err-q3" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="btn-next" data-current="3">Next Question</button>
        </fieldset>

        <fieldset id="q4" class="question-block hidden fade-in">
            <legend><h3>4. The Rules <span class="tag">Layer 4</span></h3></legend>
            <div class="question-explainer">Who defines what is "Right" and "Wrong"?</div>
            
            <label class="option-label">
                <input type="radio" name="ethics" value="divine">
                <div class="option-text"><span class="option-title">A Divine Mind (God)</span><span class="option-desc">Morality comes from the commands or nature of a God/Deity.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="ethics" value="nature">
                <div class="option-text"><span class="option-title">Cosmic Law (Nature)</span><span class="option-desc">Morality is built into the Universe (like Karma, Natural Law, or Evolutionary survival).</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="ethics" value="group">
                <div class="option-text"><span class="option-title">The Community (Group)</span><span class="option-desc">Morality is a social contract defined by culture, the state, or the tribe.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="ethics" value="individual">
                <div class="option-text"><span class="option-title">The Self (Individual)</span><span class="option-desc">Morality is subjective. I decide what is right and wrong for myself.</span></div>
            </label>
            
            <div class="validation-error" id="err-q4" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="btn-next" data-current="4">Next Question</button>
        </fieldset>

        <fieldset id="q5" class="question-block hidden fade-in">
            <legend><h3>5. The Mission <span class="tag">Layer 7</span></h3></legend>
            <div class="question-explainer">What is the ultimate goal of your journey?</div>
            
            <label class="option-label">
                <input type="radio" name="purpose" value="discovered">
                <div class="option-text"><span class="option-title">It is a Destiny (Discovered)</span><span class="option-desc">There is a meaning waiting for me to find it. My job is to discover my role in the larger story.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="purpose" value="created">
                <div class="option-text"><span class="option-title">It is an Invention (Created)</span><span class="option-desc">The universe provided a blank canvas. I must paint my own meaning and design my own purpose.</span></div>
            </label>
            
            <div class="validation-error" id="err-q5" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="submit-btn" id="btn-core-submit">Analyze My Core Profile</button>
        </fieldset>

    </section>

    <section id="view-interim" class="card hidden fade-in" aria-labelledby="interim-title">
        <h2 id="interim-title">Your Core Profile</h2>
        <div id="interim-prose" style="margin-bottom: 30px; color: #555;"></div>
        
        <div style="background: #e8f4fd; padding: 20px; border-radius: 8px; border-left: 5px solid var(--accent);">
            <h3 style="margin-top:0;">Deepen the Analysis?</h3>
            <p>You have outlined the <strong>theory</strong> of your worldview. To see which historical traditions align with your logic, we need to ask about your <strong>practice</strong>.</p>
            <button type="button" class="submit-btn" id="btn-continue-spiritual">Continue to Practice (2 Questions)</button>
            <button type="button" class="restart-btn" id="btn-skip-spiritual">Skip & View Profile</button>
        </div>
    </section>

    <section id="view-spiritual" class="card hidden fade-in" aria-live="polite">
        
        <fieldset id="q6" class="question-block active">
            <legend><h3>6. The Connection <span class="tag">Layer 5</span></h3></legend>
            <div class="question-explainer">Most traditions use both. We know you do both, but which one actually "counts" for the connection?</div>
            
            <label class="option-label">
                <input type="radio" name="mech" value="abstract">
                <div class="option-text"><span class="option-title">Internal (Rituals are Symbolic)</span><span class="option-desc">The real work happens inside (Faith, Prayer, Meditation). Rituals are symbols, but they don't save me.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="mech" value="physical">
                <div class="option-text"><span class="option-title">Physical (Rituals are Essential)</span><span class="option-desc">The real work requires action. I must participate in physical realities (Sacraments, Yoga) to bridge the gap.</span></div>
            </label>
            
            <div class="validation-error" id="err-q6" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="btn-next" data-current="6">Next Question</button>
        </fieldset>

        <fieldset id="q7" class="question-block hidden fade-in">
            <legend><h3>7. The Timeline <span class="tag">Layer 6</span></h3></legend>
            <div class="question-explainer">How does personal transformation or salvation actually happen?</div>
            
            <label class="option-label">
                <input type="radio" name="payment" value="ongoing">
                <div class="option-text"><span class="option-title">It is a Practice (Gradual)</span><span class="option-desc">It is a lifelong journey of growth. I must show up every day, learn, and evolve over time.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="payment" value="single human act">
                <div class="option-text"><span class="option-title">It is a Decision (Instant)</span><span class="option-desc">It hinges on a definitive moment of choice. Once I make that commitment, the path is set.</span></div>
            </label>
            <label class="option-label">
                <input type="radio" name="payment" value="one-time divine event">
                <div class="option-text"><span class="option-title">It is a Gift (Already Done)</span><span class="option-desc">I don't "achieve" it; I receive it. The outcome is already secured by something greater than me.</span></div>
            </label>
            
            <div class="validation-error" id="err-q7" role="alert">‚ö†Ô∏è Please select an option to continue.</div>
            <button type="button" class="submit-btn" id="btn-final-submit">Reveal My Worldview</button>
        </fieldset>

    </section>

    <section id="view-results" class="card hidden fade-in" aria-labelledby="results-title">
        <h2 id="results-title">Your Worldview Profile</h2>
        <div id="result-prose" style="margin-bottom: 20px; font-size: 1.1rem; color: #444;"></div>
        <div id="result-text"></div>
        <button type="button" class="restart-btn" id="btn-restart">Start Over</button>
    </section>

    <footer class="footer">
        Created by [ALDIGTON] ‚Ä¢ üîí No data is stored or tracked.
    </footer>

</main>

<script>
/**
 * WORLDVIEW CODEX DATABASE & LOGIC
 * Encapsulated to prevent global scope pollution.
 */
(function() {
    'use strict';

    // --- SECURITY HELPER (v64 Platinum) ---
    function setSafeHTML(element, html) {
        if (!element) return;
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        doc.querySelectorAll('script').forEach(node => node.remove());

        doc.querySelectorAll('*').forEach(node => {
            [...node.attributes].forEach(attr => {
                if (/^on/i.test(attr.name)) node.removeAttribute(attr.name);
            });
            if (node.tagName === 'A' && node.hasAttribute('href')) {
                const href = node.getAttribute('href');
                if (href && href.toLowerCase().trim().startsWith('javascript:')) node.setAttribute('href', '#');
                node.setAttribute('target', '_blank');
                node.setAttribute('rel', 'noopener noreferrer');
            }
        });

        element.replaceChildren(...doc.body.childNodes);
    }

    // --- DATA ---
    const CONFIRMED_PATHS_DB = [
        { fullPath: 'more, compatibilist, evidence, divine, physical, ongoing, discovered', fingerprint: 'more, evidence, divine, ongoing', examples: ['Roman Catholicism', 'Eastern Orthodox Christianity', 'Coptic Orthodox Church', 'Assyrian Church of the East', 'Anglicanism (High Church)', 'Oxford Movement', 'Lutheranism (High Church)', 'Methodism (Sacramental)', 'Restoration Movement', 'Church of Christ', 'LDS (Mormonism)', 'Community of Christ', 'Santer√≠a', 'Vodou (Haitian)', 'Candombl√©', 'Shinto', 'Tenrikyo'] },
        { fullPath: 'more, compatibilist, evidence, divine, abstract, ongoing, discovered', fingerprint: 'more, evidence, divine, ongoing', examples: ['Islam (Sunni)', 'Islam (Shia)', 'Islam (Ahmadiyya)', 'Orthodox Judaism', 'Conservative Judaism', 'Karaite Judaism', 'Sikhism', 'Baha\'i Faith', 'Zoroastrianism', 'Pentecostalism', 'Assembly of God', 'Church of God in Christ', 'Foursquare Church', 'Vineyard Movement', 'Evangelicalism', 'Baptist (General)', 'Free Will Baptist', 'Southern Baptist (Non-Calvinist)', 'Methodism (Low Church)', 'Wesleyan Church', 'Church of the Nazarene', 'Salvation Army', 'Holiness Movement', 'Seventh-day Adventist', 'Jehovah\'s Witnesses', 'Christadelphians', 'Anabaptism', 'Mennonite', 'Amish', 'Hutterite', 'Brethren in Christ', 'Classical Arminianism', 'Molinism'] },
        { fullPath: 'more, determinist, evidence, divine, physical, ongoing, discovered', fingerprint: 'more, evidence, divine, ongoing', examples: ['Jansenism', 'Augustinian Rigorism'] },
        { fullPath: 'more, compatibilist, reason, divine, abstract, ongoing, discovered', fingerprint: 'more, reason, divine, ongoing', examples: ['Sufism', 'Sufi Orders (Dervish)', 'Christian Mysticism', 'Quietism', 'Kabbalah', 'Hasidic Judaism', 'Jewish Mysticism', 'Quakerism (Society of Friends)', 'Shakers', 'Christian Science', 'New Thought', 'Unity Church', 'Science of Mind', 'Rosicrucianism', 'Martinism', 'Swedenborgianism', 'Brahmo Samaj'] },
        { fullPath: 'more, compatibilist, reason, divine, physical, ongoing, discovered', fingerprint: 'more, reason, divine, ongoing', examples: ['Theophilanthropy', 'Deistic Ritualism'] },
        { fullPath: 'more, source, reason, divine, physical, ongoing, discovered', fingerprint: 'more, reason, divine, ongoing', examples: ['Hermeticism', 'Neoplatonic Theurgy', 'Freemasonry', 'Masonic Rites'] },
        { fullPath: 'more, determinist, reason, divine, abstract, ongoing, discovered', fingerprint: 'more, reason, divine, ongoing', examples: ['Druze Faith', 'Alawism', 'Yezidism'] },
        { fullPath: 'more, compatibilist, reason, nature, abstract, ongoing, discovered', fingerprint: 'more, reason, nature, ongoing', examples: ['Theravada Buddhism', 'Mahayana Buddhism', 'Zen Buddhism', 'Ch\'an', 'Nichiren Buddhism', 'Secular Buddhism', 'Taoism (Classical)', 'Philosophical Taoism', 'Stoicism (Ancient)', 'Stoic Physics', 'Jainism', 'Digambara', 'Svetambara', 'Advaita Vedanta', 'Vishishtadvaita', 'Samkhya', 'Theosophy', 'Anthroposophy', 'Fourth Way (Gurdjieff)', 'Pantheism', 'Monism', 'Deep Ecology (Spiritual)', 'Ecofeminism (Spiritual)', 'Biocentrism'] },
        { fullPath: 'more, compatibilist, reason, nature, physical, ongoing, discovered', fingerprint: 'more, reason, nature, ongoing', examples: ['Vajrayana (Tibetan Buddhism)', 'Dzogchen', 'Neo-Confucianism', 'Pythagoreanism'] },
        { fullPath: 'more, determinist, reason, nature, abstract, ongoing, discovered', fingerprint: 'more, reason, nature, ongoing', examples: ['Gnosticism (Sethian)', 'Manichaeism', 'Catharism', 'Philosophical Pessimism'] },
        { fullPath: 'more, source, reason, nature, abstract, ongoing, discovered', fingerprint: 'more, reason, nature, ongoing', examples: ['Classical Deism', 'Pelagianism', 'Unitarianism (Historical)'] },
        { fullPath: 'more, compatibilist, reason, individual, abstract, ongoing, discovered', fingerprint: 'more, reason, individual, ongoing', examples: ['Transcendentalism', 'Emersonian Spirituality', 'Romanticism'] },
        { fullPath: 'more, compatibilist, evidence, nature, abstract, ongoing, discovered', fingerprint: 'more, evidence, nature, ongoing', examples: ['Hinduism (General)', 'Smartism', 'Arya Samaj', 'Wicca (Eclectic)', 'Kemetism', 'Soka Gakkai'] },
        { fullPath: 'more, compatibilist, evidence, nature, physical, ongoing, discovered', fingerprint: 'more, evidence, nature, ongoing', examples: ['Taoism (Religious)', 'Daoist Alchemy', 'Asatru', 'Heathenry', 'Norse Paganism', 'Theodism', 'Modern Druidry', 'Celtic Reconstructionism', 'Hellenic Polytheism', 'Santo Daime', 'Umbanda', 'Spiritualism', 'Espiritismo', 'Tantra', 'Kundalini Yoga', 'Hatha Yoga', 'Kriya Yoga', 'Agama Hinduism', 'Shaivism', 'Shaktism'] },
        { fullPath: 'more, determinist, evidence, nature, physical, ongoing, discovered', fingerprint: 'more, evidence, nature, ongoing', examples: ['Mandaeism', 'Sabianism'] },
        { fullPath: 'more, compatibilist, evidence, group, physical, ongoing, discovered', fingerprint: 'more, evidence, group, ongoing', examples: ['Shamanism', 'Neo-Shamanism', 'Indigenous Australian Spirituality', 'Dreamtime', 'Native American Church', 'Lakota Tradition', 'Inuit Shamanism', 'Yoruba Religion'] },
        { fullPath: 'more, determinist, evidence, divine, abstract, one-time divine event, discovered', fingerprint: 'more, evidence, divine, one-time divine event', examples: ['Calvinism', 'Reformed Christianity', 'Presbyterianism', 'Congregationalism', 'Primitive Baptist', 'Strict Baptist', 'Hyper-Calvinism', 'Huguenots', 'Puritanism'] },
        { fullPath: 'more, determinist, evidence, divine, physical, one-time divine event, discovered', fingerprint: 'more, evidence, divine, one-time divine event', examples: ['Lutheranism (Confessional)', 'Old Lutheranism'] },
        { fullPath: 'more, determinist, evidence, nature, abstract, one-time divine event, discovered', fingerprint: 'more, evidence, nature, one-time divine event', examples: ['Pure Land Buddhism', 'Jodo Shinshu', 'Jodo Shu'] },
        { fullPath: 'more, compatibilist, evidence, nature, physical, one-time divine event, discovered', fingerprint: 'more, evidence, nature, one-time divine event', examples: ['Kashi Moksha', 'Ritual Suicide (Historical Jainism)'] },
        { fullPath: 'more, compatibilist, reason, group, physical, ongoing, discovered', fingerprint: 'more, reason, group, ongoing', examples: ['Confucianism', 'Aristotelianism', 'Legalism (Chinese)'] },
        { fullPath: 'more, compatibilist, evidence, group, abstract, ongoing, discovered', fingerprint: 'more, evidence, group, ongoing', examples: ['Romani Religion', 'Folk Catholicism'] },
        { fullPath: 'more, compatibilist, evidence, group, abstract, ongoing, created', fingerprint: 'more, evidence, group, ongoing', examples: ['Liberation Theology', 'Black Theology', 'Feminist Theology'] },
        { fullPath: 'more, compatibilist, reason, group, abstract, ongoing, created', fingerprint: 'more, reason, group, ongoing', examples: ['Unitarian Universalism', 'Ethical Culture', 'Reconstructionist Judaism'] },
        { fullPath: 'more, compatibilist, reason, group, physical, ongoing, created', fingerprint: 'more, reason, group, ongoing', examples: ['Civil Religion', 'State Shinto (Historical)'] },
        { fullPath: 'physical, source, reason, group, na, na, created', fingerprint: 'physical, reason, group, na', examples: ['Existentialist Marxism', 'Sartrean Socialism', 'Situationist International'] },
        { fullPath: 'more, compatibilist, evidence, individual, abstract, ongoing, discovered', fingerprint: 'more, evidence, individual, ongoing', examples: ['New Age Spirituality', 'Self-Realization Fellowship', 'Eckankar', 'I Am Movement'] },
        { fullPath: 'more, compatibilist, evidence, individual, physical, ongoing, discovered', fingerprint: 'more, evidence, individual, ongoing', examples: ['Thelema', 'Hermetic Order of the Golden Dawn', 'Ordo Templi Orientis', 'Ceremonial Magic'] },
        { fullPath: 'more, compatibilist, evidence, individual, physical, ongoing, created', fingerprint: 'more, evidence, individual, ongoing', examples: ['Obeah', 'Hoodoo', 'Rootwork', 'Folk Magic'] },
        { fullPath: 'more, compatibilist, reason, individual, physical, ongoing, discovered', fingerprint: 'more, reason, individual, ongoing', examples: ['Vamachara', 'Left-Hand Path Tantra', 'Aghori'] },
        { fullPath: 'more, source, reason, individual, abstract, ongoing, created', fingerprint: 'more, reason, individual, ongoing', examples: ['Solipsism', 'Subjective Idealism'] },
        { fullPath: 'more, source, reason, individual, abstract, single human act, created', fingerprint: 'more, reason, individual, single human act', examples: ['Discordianism', 'Chaos Magic'] },
        { fullPath: 'more, compatibilist, reason, divine, abstract, ongoing, created', fingerprint: 'more, reason, divine, ongoing', examples: ['Process Theology', 'Moralistic Therapeutic Deism', 'Emergent Church', 'Progressive Christianity'] },
        { fullPath: 'more, compatibilist, evidence, divine, abstract, ongoing, created', fingerprint: 'more, evidence, divine, ongoing', examples: ['Open Theism', 'Post-Conservative Evangelicalism'] },
        { fullPath: 'more, compatibilist, reason, divine, abstract, one-time divine event, created', fingerprint: 'more, reason, divine, one-time divine event', examples: ['Christian Universalism', 'Universalist Church of America'] },
        { fullPath: 'more, compatibilist, evidence, divine, physical, one-time divine event, discovered', fingerprint: 'more, evidence, divine, one-time divine event', examples: ['Eleusinian Mysteries', 'Mithraism'] },
        { fullPath: 'more, compatibilist, evidence, divine, abstract, single human act, discovered', fingerprint: 'more, evidence, divine, single human act', examples: ['Free Grace Theology', 'Zane Hodges Theology', 'Easy Believism'] },
        { fullPath: 'more, compatibilist, evidence, divine, abstract, one-time divine event, discovered', fingerprint: 'more, evidence, divine, one-time divine event', examples: ['Eternal Security Baptist', 'Calvary Chapel', 'Independent Fundamental Baptist'] },
        { fullPath: 'physical, compatibilist, reason, group, na, na, created', fingerprint: 'physical, reason, group, na', examples: ['Secular Humanism', 'Humanistic Judaism', 'Utilitarianism', 'Pragmatism'] },
        { fullPath: 'physical, compatibilist, evidence, group, na, na, created', fingerprint: 'physical, evidence, group, na', examples: ['Academic Skepticism', 'Scientific Materialism', 'Logical Positivism', 'Empiricism'] },
        { fullPath: 'physical, determinist, evidence, group, na, na, discovered', fingerprint: 'physical, evidence, group, na', examples: ['Marxism', 'Historical Materialism', 'Dialectical Materialism', 'Communism'] },
        { fullPath: 'physical, source, reason, individual, na, na, created', fingerprint: 'physical, reason, individual, na', examples: ['Objectivism', 'LaVeyan Satanism', 'Transhumanism', 'Rational Egoism'] },
        { fullPath: 'physical, source, evidence, individual, na, na, created', fingerprint: 'physical, evidence, individual, na', examples: ['Epicureanism', 'Hedonism'] },
        { fullPath: 'physical, compatibilist, reason, individual, na, na, created', fingerprint: 'physical, reason, individual, na', examples: ['Nihilism', 'Existentialism', 'Absurdism (Camus)', 'Post-Structuralism'] },
        { fullPath: 'physical, source, reason, group, na, na, created', fingerprint: 'physical, reason, group, na', examples: ['The Satanic Temple (TST)'] },
        { fullPath: 'physical, compatibilist, evidence, individual, na, na, created', fingerprint: 'physical, evidence, individual, na', examples: ['Raelism', 'UFO Religions'] },
        { fullPath: 'physical, compatibilist, reason, individual, na, na, created', fingerprint: 'physical, reason, individual, na', examples: ['Modern Epicureanism'] },
        { fullPath: 'physical, source, evidence, nature, na, na, created', fingerprint: 'physical, evidence, nature, na', examples: ['Cynicism'] },
        { fullPath: 'physical, compatibilist, evidence, nature, na, na, created', fingerprint: 'physical, evidence, nature, na', examples: ['Social Darwinism', 'Ecofeminism (Secular)', 'Deep Ecology (Secular)'] },
        { fullPath: 'physical, determinist, reason, nature, na, na, discovered', fingerprint: 'physical, reason, nature, na', examples: ['Spinozism', 'Determinism'] },
        { fullPath: 'physical, determinist, evidence, nature, na, na, discovered', fingerprint: 'physical, evidence, nature, na', examples: ['Biological Determinism', 'Evolutionary Psychology', 'Sociobiology'] },
        { fullPath: 'more, compatibilist, evidence, nature, physical, ongoing, created', fingerprint: 'more, evidence, nature, ongoing', examples: ['Atheopaganism', 'Naturalistic Pantheism'] }
    ];

    const questionMap = { q1: 'meta', q2: 'agency', q3: 'epist', q4: 'ethics', q5: 'purpose', q6: 'mech', q7: 'payment' };
    const userProfile = { meta: null, agency: null, epist: null, ethics: null, purpose: null, mech: null, payment: null };

    // --- DOM MANIPULATION ---

    function switchView(viewId) {
        document.querySelectorAll('section.card').forEach(el => el.classList.add('hidden'));
        const activeView = document.getElementById(viewId);
        activeView.classList.remove('hidden');
        window.scrollTo(0,0);
        
        // Focus Management: Move focus to the first heading for accessibility
        const heading = activeView.querySelector('h1, h2, h3');
        if (heading) {
            heading.setAttribute('tabindex', '-1');
            heading.focus();
        }
    }

    function showQuestion(qID) {
        document.querySelectorAll('.question-block').forEach(q => q.classList.add('hidden'));
        document.querySelectorAll('.validation-error').forEach(e => e.style.display = 'none');
        document.getElementById(qID).classList.remove('hidden');
    }

    // Logic Refactor: Simplified handleNext to rely on explicit IDs
    function handleNext(currentStep) {
        const qID = `q${currentStep}`;
        const qName = questionMap[qID];
        const selected = document.querySelector(`input[name="${qName}"]:checked`);
        const errorMsg = document.getElementById(`err-${qID}`);
        
        if (!selected) {
            errorMsg.style.display = 'block';
            return;
        }
        
        errorMsg.style.display = 'none';
        userProfile[qName] = selected.value;
        showQuestion(`q${parseInt(currentStep) + 1}`);
    }

    function handleCoreSubmit() {
        const selected = document.querySelector(`input[name="purpose"]:checked`);
        const errorMsg = document.getElementById('err-q5');
        
        if (!selected) {
            errorMsg.style.display = 'block';
            return;
        }
        
        errorMsg.style.display = 'none';
        userProfile.purpose = selected.value;
        
        if (userProfile.meta === 'physical') {
            userProfile.mech = 'na';
            userProfile.payment = 'na';
            showFinalResults();
        } else {
            let prose = `So far, you believe there is <strong>Something More</strong> than the physical world. `;
            prose += `You see yourself as the <strong>${userProfile.agency === 'source' ? 'Author' : userProfile.agency === 'compatibilist' ? 'Improviser' : 'Role-Player'}</strong> of your life. `;
            prose += `You look <strong>${userProfile.epist === 'evidence' ? 'Outward' : 'Inward'}</strong> for truth and define rules based on <strong>${userProfile.ethics}</strong> standards.`;
            // Safe injection
            setSafeHTML(document.getElementById('interim-prose'), prose);
            switchView('view-interim');
        }
    }

    function handleSubmitSpiritual() {
        const selected = document.querySelector(`input[name="payment"]:checked`);
        const errorMsg = document.getElementById('err-q7');
        
        if (!selected) {
            errorMsg.style.display = 'block';
            return;
        }
        
        errorMsg.style.display = 'none';
        userProfile.payment = selected.value;
        showFinalResults();
    }

    // Paradox Logic (No changes needed)
    function checkConstraints(p) {
        const err = [];
        try {
            if (p.meta === 'physical' && p.ethics === 'divine') err.push("Philosophical Paradox: A purely physical universe cannot have Divine ethics.");
            if (p.meta === 'physical') {
                if (p.agency === 'determinist' && p.purpose === 'created') err.push("Philosophical Paradox: If the universe is physically determined, purpose is inevitable (Discovered), not Created.");
                if (p.agency !== 'determinist' && p.purpose === 'discovered') err.push("Philosophical Paradox: Without a Determiner (God/Fate), purpose must be Created by you.");
            }
            if (p.meta === 'more') {
                if (p.agency === 'determinist' && p.payment === 'single human act') err.push("Philosophical Paradox: If your path is Determined, you cannot be saved by a Single Human Choice.");
                if (p.agency === 'source' && p.payment === 'one-time divine event') err.push("Philosophical Paradox: Absolute Free Will conflicts with a unilateral Divine Event overriding it.");
                if (p.agency === 'determinist' && p.purpose === 'created') err.push("Philosophical Paradox: If everything is Determined, purpose is pre-set (Discovered), not Created.");
                if (p.agency === 'determinist' && p.ethics === 'individual') err.push("Philosophical Paradox: If you are Determined, you cannot independently define your own Individual ethics.");
            }
        } catch (e) {
            // Logic check fail - silent in production
        }
        return err;
    }

    function getUniqueAnalysis(p) {
        if (p.meta === 'physical') return "You hold a complex <strong>Secular</strong> worldview. You reject the spiritual, yet your combination of Ethics and Agency creates a unique philosophy that doesn't fit standard Materialist categories.";
        if (p.agency === 'compatibilist' && p.mech === 'physical' && p.payment === 'one-time divine event') return "You believe in <strong>'The Tangible Believer.'</strong> You freely choose to perform a physical ritual (like baptism), and that single act settles your connection to the divine forever.";
        if (p.agency === 'determinist' && p.epist === 'reason') return "You are <strong>'The Wise Observer.'</strong> You believe destiny is fixed by fate, yet you use your own logic to understand it.";
        if (p.agency === 'source' && p.ethics === 'group') return "You are <strong>'The Community Individualist.'</strong> You deeply value your personal freedom to choose, but you recognize that right and wrong are not private decisions‚Äîthey are defined by our shared responsibility to the community.";
        if (p.ethics === 'nature' && p.purpose === 'created') return "You believe in <strong>'The Blank Script.'</strong> You agree the stage is set with strict rules (like Karma or Nature), but the script is blank. You have to write the story yourself.";
        if (p.ethics === 'divine' && p.purpose === 'created') return "You believe in <strong>'God's House, Your Rules.'</strong> You accept that God established the moral laws, but gave you no specific purpose. You must build your own meaning within God's framework.";
        if (p.ethics === 'individual' && p.mech === 'physical') return "You practice <strong>'Personalized Sacred Practice.'</strong> You believe morality is subjective and defined by you, yet you rely on meaningful physical rituals to connect with the spiritual.";
        return "Your worldview is a highly specific <strong>'Custom Build.'</strong> You have combined theological blocks‚ÄîAgency, Ethics, and Ritual‚Äîin a way that no major historical religion has standardized.";
    }

    function getFingerprint(p) { return [p.meta, p.epist, p.ethics, p.payment].join(', '); }

    function findClosestMatch(userFingerprint) {
        const matches = new Set();
        CONFIRMED_PATHS_DB.forEach(path => {
            if (path.fingerprint === userFingerprint) { path.examples.forEach(example => matches.add(example)); }
        });
        return matches.size > 0 ? Array.from(matches) : null;
    }

    function getFullPath(p) { return [p.meta, p.agency, p.epist, p.ethics, p.mech, p.payment, p.purpose].join(', '); }

    function showFinalResults() {
        try {
            switchView('view-results');
            const fullPath = getFullPath(userProfile);
            const errors = checkConstraints(userProfile);
            const resultDiv = document.getElementById('result-text');
            
            let prose = `Your worldview is rooted in a <strong>${userProfile.meta === 'physical' ? 'Physical' : 'Spiritual'}</strong> reality. `;
            
            if(userProfile.agency === 'source') prose += `You see yourself as the <strong>Author</strong> of your own script, `;
            else if(userProfile.agency === 'compatibilist') prose += `You see yourself <strong>Improvising</strong> within a larger story, `;
            else prose += `You view your life as a <strong>Role</strong> written by fate or biology, `;
            
            prose += `and you look <strong>${userProfile.epist === 'evidence' ? 'Outward' : 'Inward'}</strong> for your moral compass. `;
            
            if(userProfile.ethics === 'divine') prose += `You believe the rules are set by a <strong>Higher Power</strong>. `;
            else if(userProfile.ethics === 'nature') prose += `You believe the rules are woven into <strong>Natural Law</strong>. `;
            else if(userProfile.ethics === 'group') prose += `You believe the rules are defined by the <strong>Community</strong>. `;
            else prose += `You believe the rules are defined by the <strong>Individual</strong>. `;
            
            if(userProfile.mech && userProfile.mech !== 'na') {
                prose += `To connect with this truth, you rely on <strong>${userProfile.mech === 'abstract' ? 'Internal Faith' : 'Physical Rituals'}</strong>. `;
                if (userProfile.payment === 'ongoing') prose += `You view the path forward as a <strong>Continuous Practice</strong>. `;
                else if (userProfile.payment === 'single human act') prose += `You believe the path hinges on <strong>One Decisive Moment</strong>. `;
                else prose += `You believe the outcome is a <strong>Received Gift</strong> (like Grace) rather than your own effort. `;
            }
            
            if (userProfile.purpose === 'discovered') prose += `Ultimately, you believe your mission is <strong>Pre-ordained</strong> for you to discover.`;
            else prose += `Ultimately, you believe your mission is <strong>Created</strong> by you.`;
            
            setSafeHTML(document.getElementById('result-prose'), prose);
            
            if (errors.length > 0) {
                const paradoxHtml = `<div class="result-box result-paradox"><h3>üî∏ Philosophical Paradox</h3><p>You selected ideas that usually conflict with each other. Your worldview has a tension between:</p><ul class="result-list">${errors.map(e => `<li>${e}</li>`).join('')}</ul><div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e6b980;"><p style="font-size: 0.95rem; color: #8a6d3b;"><strong>Teacher's Note:</strong> Don't worry, this happens! It usually means you are trying to hold onto two opposites (like <strong>Total Control</strong> vs. <strong>Total Destiny</strong>) at the same time.</p><p style="font-size: 0.95rem; color: #8a6d3b;">To find your true path, <strong>Start Over</strong> and ask yourself: <em>"If I had to pick only one, which is more true?"</em></p></div></div>`;
                setSafeHTML(resultDiv, paradoxHtml);
            } else {
                const match = CONFIRMED_PATHS_DB.find(p => p.fullPath === fullPath);
                
                if (match) {
                    const matchHtml = `<div class="result-box result-confirmed"><h3>üü© Confirmed Path</h3><p>Your worldview matches a specific historical tradition:</p><ul class="result-list">${match.examples.map(e => `<li>${e}</li>`).join('')}</ul></div>`;
                    setSafeHTML(resultDiv, matchHtml);
                } else {
                    const explanation = getUniqueAnalysis(userProfile);
                    let html = `<div class="result-box result-unconfirmed"><h3>üü® Unique Path</h3><p>${explanation}</p>`;
                    
                    if (userProfile.payment) {
                        const matches = findClosestMatch(getFingerprint(userProfile));
                        if (matches && matches.length > 0) {
                            html += `<div style="margin-top:20px; padding-top:10px; border-top:1px solid #ddd;"><h4>Your Philosophical Family</h4><p>While your exact path is unique, you share core values with:</p><ul class="result-list">${matches.map(m => `<li>${m}</li>`).join('')}</ul></div>`;
                        } else {
                            html += `<div style="margin-top:20px; padding-top:10px; border-top:1px solid #ddd;"><h4>üß© Unaligned Worldview</h4><p>Your worldview is logically valid, but historically rare (No Match Found).</p><p style="font-size: 0.9rem; color: #666; margin-top: 10px;"><strong>Teacher's Note:</strong> Most people align with a tradition. Since you didn't, you might have mismatched your <strong>Theory</strong> (Foundation/Rules) with your <strong>Practice</strong> (Timeline).</p><p style="font-size: 0.9rem; color: #666;">If this feels accidental, you might want to double-check your path.</p></div>`;
                        }
                    }
                    html += `</div>`;
                    setSafeHTML(resultDiv, html);
                }
            }
        } catch (e) {
            setSafeHTML(document.getElementById('result-text'), `<div class="result-box result-error"><h3>‚ö†Ô∏è System Error</h3><p>An unexpected error occurred while calculating your results.</p></div>`);
        }
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('btn-start').addEventListener('click', () => {
            switchView('view-quiz');
            showQuestion('q1');
        });

        document.querySelectorAll('.btn-next').forEach(btn => {
            btn.addEventListener('click', (e) => {
                handleNext(e.target.getAttribute('data-current'));
            });
        });

        document.getElementById('btn-core-submit').addEventListener('click', handleCoreSubmit);
        document.getElementById('btn-continue-spiritual').addEventListener('click', () => {
            switchView('view-spiritual');
            showQuestion('q6');
        });
        document.getElementById('btn-skip-spiritual').addEventListener('click', showFinalResults);
        document.getElementById('btn-final-submit').addEventListener('click', handleSubmitSpiritual);
        document.getElementById('btn-restart').addEventListener('click', () => {
            location.reload();
        });
    });

})();
</script>
</body>
</html>
